/*!
 * MIDI Events 0.2.1
 *
 * @author Mikael Jorhult
 * @license https://github.com/mikaeljorhult/midi-events MIT
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.midiEvents=t()}}(function(){return function t(n,e,o){function r(u,a){if(!e[u]){if(!n[u]){var f="function"==typeof require&&require;if(!a&&f)return f(u,!0);if(i)return i(u,!0);var p=new Error("Cannot find module '"+u+"'");throw p.code="MODULE_NOT_FOUND",p}var s=e[u]={exports:{}};n[u][0].call(s.exports,function(t){var e=n[u][1][t];return r(e?e:t)},s,s.exports,t,n,e,o)}return e[u].exports}for(var i="function"==typeof require&&require,u=0;u<o.length;u++)r(o[u]);return r}({1:[function(t,n,e){function o(n,e){var o=t("./main");this.inputs=o.inputs(n),this.outputs=o.outputs(e)}var r=t("./PubSub");o.prototype.send=function(n,e){var o=t("./main");return o.send(this.outputs,n,e),this},o.prototype.listen=function(t){var n,e=this.inputs.length;for(n=0;e>n;n++)r.on("id:"+this.inputs[n].id,t);return this},o.prototype.unlisten=function(t){var n,e=this.inputs.length;for(n=0;e>n;n++)r.off(r.on("id:"+this.inputs[n].id,t));return this},o.prototype.on=function(t,n){var e,o=this.inputs.length;for(t=":"+t,e=0;o>e;e++)r.on("id:"+this.inputs[e].id+t,n);return this},o.prototype.off=function(t,n){var e,o=this.inputs.length;for(t=":"+t,e=0;o>e;e++)r.off(r.on("id:"+this.inputs[e].id+t,n));return this},o.prototype.noteon=function(t){this.on("noteon",t)},o.prototype.noteoff=function(t){this.on("noteoff",t)},o.prototype.controller=function(t){this.on("controller",t)},n.exports=o},{"./PubSub":2,"./main":3}],2:[function(t,n,e){var o={};n.exports={trigger:function(t,n,e){if(o[t]){var r=o[t],i=r.length-1;for(i;i>=0;i-=1)r[i].apply(e||this,n||[])}},on:function(t,n){return o[t]||(o[t]=[]),o[t].push(n),[t,n]},off:function(t,n){var e=t[0],r=o[e].length-1;if(o[e])for(r;r>=0;r-=1)o[e][r]===t[1]&&(o[e].splice(o[e][r],1),n&&delete o[e])}}},{}],3:[function(t,n,e){"use strict";function o(t){j.then(function(n){D=n,S=h(D.inputs.values()),k=h(D.outputs.values()),u(),I.trigger("connected"),"function"==typeof t&&t()},g)}function r(t){return p("input",t)}function i(t){return p("output",t)}function u(t){var n,e=r(t),o=e.length;for(n=0;o>n;n++)e[n].addEventListener("midimessage",f,!1)}function a(t){var n,e=r(t),o=e.length;for(n=0;o>n;n++)e[n].removeEventListener("midimessage",f,!1)}function f(t){var n={port:s("id",t.target.id),type:"unsupported",channel:0};switch(n.note=t.data[1],n.value=t.data[2],n.originalEvent=t,!0){case t.data[0]<128:break;case t.data[0]<144||t.data[0]<160&&0===t.data[2]:n.type="noteoff",n.channel=t.data[0]-(t.data[0]>143?144:128);break;case t.data[0]<160:n.type="noteon",n.channel=t.data[0]-144;break;case t.data[0]<176:n.type="polyphonic-aftertouch",n.channel=t.data[0]-160;break;case t.data[0]<192:n.type="controller",n.channel=t.data[0]-176;break;case t.data[0]<208:n.type="controlchange",n.channel=t.data[0]-192,n.note=0,n.value=t.data[1];break;case t.data[0]<224:n.type="aftertouch",n.channel=t.data[0]-208,n.note=0,n.value=t.data[1]}I.trigger("message",[n]),I.trigger(n.type,[n]),I.trigger(n.type+":"+n.note,[n]),I.trigger("port:"+n.port,[n]),I.trigger("id:"+t.target.id,[n]),I.trigger("id:"+t.target.id+":"+n.type,[n])}function p(t,n){var e,o="output"===t?k:S,r=[],i=[];if("number"==typeof n?n<o.length&&i.push(o[n]):Object.prototype.toString.call(n).match(/^\[object MIDI(Input|Output)]$/)?i.push(n):"[object Array]"===Object.prototype.toString.call(n)?r=n:("string"==typeof n&&"all"===n.toLowerCase()||void 0===n)&&(i=o),r.length>0)for(e=0;e<r.length;e++)"number"==typeof r[e]?r[e]<o.length&&i.push(o[n]):Object.prototype.toString.call(r[e]).match(/^\[object MIDI(Input|Output)]$/)&&i.push(r[e]);return i}function s(t,n){return l("input",t,n)}function c(t,n){return l("output",t,n)}function l(t,n,e){var o,r="output"===t?k:S,i=r.length,u=[];for(o=0;i>o;o++)r[o].hasOwnProperty(n)&&r[o][n]===e&&u.push(r[o]);return u}function d(t,n,e){var o,r,u=i(t);for("[object Array]"!==Object.prototype.toString.call(n)&&(n=[n]),o=0;o<n.length;o++)switch(n[o].type){case"noteon":n[o].type=144;break;case"noteoff":n[o].type=128}for(o=0;o<u.length;o++)for(r=0;r<n.length;r++)u[o].send([n[r].type,n[r].note,n[r].value],void 0===e?window.performance.now():e)}function h(t){for(var n,e=[];!(n=t.next()).done;)e.push(n.value);return e}function g(t){console.log(t)}function v(t){I.on("noteon",t)}function y(t){I.on("noteoff",t)}function b(t){I.on("controller",t)}function m(t,n){return new w(t,n)}var w=t("./Device"),I=t("./PubSub"),O={},x=!!window.navigator.requestMIDIAccess,j=x?navigator.requestMIDIAccess():null,D=null,S=[],k=[];O={supported:x,connect:o,inputs:r,outputs:i,listen:u,unlisten:a,send:d,resolveInputPort:s,resolveOutputPort:c,createDevice:m,on:I.on,off:I.off,noteon:v,noteoff:y,controller:b},n.exports=O},{"./Device":1,"./PubSub":2}]},{},[3])(3)});